<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Activity Template Creator</title>
    <link
      href="https://cn.vitejs.dev/logo-with-shadow.png"
      rel="shortcut icon"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.js"></script>
    <script src="//unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/dayjs/dayjs.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #fff;
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .warp {
        width: 800px;
        padding: 20px;
        padding-top: 0px;
        animation: fadeInUp 0.6s ease-out;
      }

      .title {
        width: 100%;
        height: 80px;
        line-height: 80px;
        text-align: center;
        font-size: 28px;
        font-weight: 700;
        color: white;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .form-container {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid #e4e7ed;
      }

      .el-form-item {
        margin-bottom: 26px;
      }

      .el-form-item__label {
        font-weight: 600 !important;
        color: #2c3e50 !important;
      }

      .el-input {
        border-radius: 8px !important;
      }

      .el-radio-button {
        margin-right: 8px !important;
      }

      .el-radio-button__inner {
        border-radius: 6px !important;
      }

      .el-radio-button__original-radio:checked + .el-radio-button__inner {
        background: linear-gradient(135deg, #409eff, #36a3f7) !important;
        border-color: #409eff !important;
      }

      .action-buttons {
        margin-top: 20px;
        display: flex;
        justify-content: center;
      }

      .el-button--success {
        background: linear-gradient(135deg, #67c23a, #85ce61) !important;
        border: none !important;
        border-radius: 8px !important;
        padding: 12px 32px !important;
        font-weight: 600 !important;
        font-size: 16px !important;
        height: auto !important;
        box-shadow: 0 4px 15px rgba(103, 194, 58, 0.3) !important;
      }

      .el-button--success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(103, 194, 58, 0.4) !important;
      }

      .el-button--primary {
        border-radius: 8px !important;
        min-width: 90px !important;
        flex-shrink: 0 !important;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        .warp {
          width: 95%;
        }
        .title {
          font-size: 22px;
          height: 60px;
          line-height: 60px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="warp">
        <div class="title">Activity Template Creator</div>
        <div class="form-container">
          <el-form :model="form" label-width="140px">
            <el-form-item label="Project Name">
              <el-radio-group v-model="form.projectName">
                <el-radio-button label="Yoho"></el-radio-button>
                <el-radio-button label="Hiyoo"></el-radio-button>
                <el-radio-button label="SoulStar"></el-radio-button>
                <el-radio-button label="DramaBit"></el-radio-button>
              </el-radio-group>
            </el-form-item>
            <el-form-item label="General activity">
              <el-radio-group v-model="form.isGeneral">
                <el-radio-button label="true"></el-radio-button>
                <el-radio-button label="false"></el-radio-button>
              </el-radio-group>
            </el-form-item>
            <el-form-item label="Activity catalog">
              <el-input v-model="form.catalog" placeholder="e.g. 202412" />
            </el-form-item>
            <el-form-item label="Activity Name">
              <el-input v-model="form.name" placeholder="活动名称（必填）" />
            </el-form-item>
            <el-form-item label="Activity ID">
              <el-input v-model="form.id" placeholder="活动 ID" />
            </el-form-item>
            <el-form-item label="Document URL">
              <el-input v-model="form.url" placeholder="需求文档链接" />
            </el-form-item>
            <el-form-item label="Text URL">
              <el-input v-model="form.textUrl" placeholder="飞书文案链接" />
            </el-form-item>
            <el-form-item label="">
              <el-button
                type="primary"
                @click="uploadText"
                :loading="textLoading"
              >
                上传文案
              </el-button>
            </el-form-item>
            <el-form-item label="Figma URL">
              <el-input v-model="form.figma" placeholder="设计稿链接" />
            </el-form-item>
            <el-form-item label="Background">
              <el-input v-model="form.bgc" placeholder="背景色，如 #ffffff" />
            </el-form-item>
            <el-form-item label="Swiper OP">
              <div style="display: flex; align-items: center; gap: 10px">
                <el-radio-group v-model="form.op">
                  <el-radio-button label="true"></el-radio-button>
                  <el-radio-button label="false"></el-radio-button>
                </el-radio-group>
                <el-input
                  v-model="form.opNum"
                  style="width: 120px"
                  placeholder="数量"
                />
              </div>
            </el-form-item>
            <el-form-item label="Hot Banner">
              <div style="display: flex; align-items: center; gap: 10px">
                <el-radio-group v-model="form.hot">
                  <el-radio-button label="true"></el-radio-button>
                  <el-radio-button label="false"></el-radio-button>
                </el-radio-group>
                <el-input
                  v-model="form.hotNum"
                  style="width: 120px"
                  placeholder="数量"
                />
              </div>
            </el-form-item>
            <div class="action-buttons">
              <el-button
                type="success"
                @click="downloadTemplate"
                v-loading.fullscreen.lock="loading"
              >
                Create Template
              </el-button>
            </div>
          </el-form>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, reactive, watch } = Vue;
      const { ElMessage } = window.ElementPlus;

      const App = {
        setup() {
          const form = reactive({
            projectName: "Yoho",
            isGeneral: "false",
            catalog: dayjs().format("YYYYMM"),
            bgc: "",
            name: "",
            id: "",
            url: "",
            textUrl: "",
            figma: "",
            op: "true",
            hot: "true",
            opNum: "1",
            hotNum: "1",
          });

          const loading = ref(false);
          const textLoading = ref(false);

          // 监听 isGeneral 变化
          watch(
            () => form.isGeneral,
            (val) => {
              form.catalog =
                val === "true" ? "general" : dayjs().format("YYYYMM");
            }
          );

          // 上传文案
          const uploadText = async () => {
            if (!form.id) {
              ElMessage.warning("请输入 Activity ID");
              return;
            }
            if (!form.name) {
              ElMessage.warning("请输入 Activity Name");
              return;
            }
            if (!form.textUrl) {
              ElMessage.warning("请输入飞书文案链接");
              return;
            }

            textLoading.value = true;
            try {
              const res = await axios.post(
                "http://localhost:3000/toPythonText",
                {
                  id: form.id,
                  name: form.projectName,
                  textUrl: form.textUrl,
                }
              );

              if (res.data.data && res.data.data.code === 1) {
                ElMessage.success(res.data.data.message || "文案上传成功");
              } else {
                ElMessage.error(res.data.data?.message || "上传失败");
              }
            } catch (error) {
              ElMessage.error("上传失败: " + (error.message || "请检查网络"));
            } finally {
              textLoading.value = false;
            }
          };

          // 下载模板
          const downloadTemplate = async () => {
            if (!form.name) {
              ElMessage.warning("请输入 Activity Name");
              return;
            }

            loading.value = true;
            try {
              const res = await axios.post(
                "http://localhost:3000/download-template",
                {
                  projectName: form.projectName,
                  name: form.name,
                  id: form.id,
                  url: form.url,
                  textUrl: form.textUrl,
                  figma: form.figma,
                  bgc: form.bgc,
                  catalog: form.catalog,
                  op: form.op,
                  opNum: form.opNum || 1,
                  hot: form.hot,
                  hotNum: form.hotNum || 1,
                }
              );

              if (res.data.success) {
                ElMessage.success(res.data.message);
              } else {
                ElMessage.error(res.data.message || "下载失败");
              }
            } catch (error) {
              ElMessage.error("下载失败: " + (error.message || "请检查网络"));
            } finally {
              loading.value = false;
            }
          };

          return {
            form,
            loading,
            textLoading,
            downloadTemplate,
            uploadText,
          };
        },
      };

      createApp(App).use(window.ElementPlus).mount("#app");
    </script>
  </body>
</html>
